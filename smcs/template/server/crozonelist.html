<html>
#include("include/inc_header_v2.html")
<body>
#include("include/inc_position.html")
<script type="text/javascript">
$(document).ready(function(){
	$(".updateZone").click(function(){
		var hostID = $(this).parent().parent().attr("id");
		var server = $(this).parent().parent().find(".targetserver").val();
		var zone = $(this).parent().parent().find(".zone").val();
		$.post("/croservermgr/updatezone",{hostID:hostID,server:server,zone:zone},function(result){
			if(result){
				alert("修改成功！");
			}
		});
	});
	$("#export").click(function(){
		var serviceID = $("#serviceid").val();
		$.post("/croservermgr/exportzone",{serviceID:serviceID},function(result){
			if(result && parseInt(result) == 1){
				alert("生成成功！");
				window.location.href = "/croservermgr/croserverlist";
			}
		});
	});
})
</script>
<div class="page-header">
	<h3>战区分配列表</h3>
</div> 
<table class="table table-striped table-bordered table-hover">
	<thead>
	<tr>
		<th>战区</th>
		<th>平台</th> 
		<th>服务器</th>
		<th>开服时间</th>
		<th>7日在线峰值</th>
		<th>目标服</th>
		<th>操作</th>
	</tr>
	</thead>
	<tbody>
#for ZoneName, Servers in pairs(CroList) do
#for id, Server in ipairs(Servers) do
	<tr id="$Server.HostID$">
			<td>
				<select name="zoneid" class="zone">
#for _, Zone in ipairs(ZoneList) do
					<option value="$Zone$" $ZoneName == Zone and "selected" or ""$>$Zone$</option>
#end
			</td>

			<td>$PlatformMap[Server.platformid]$</td>
			<td>$Server.name$</td>
			<td>$os.date("%Y-%m-%d %X",(Server.StartTime or ngx.time()))$</td>
			<td>$(Server.Avg7Num or 0)$</td>
			<td>
				<select name="targetserverid" class="targetserver">
#for _, TargetServer in ipairs(TargetServers) do
#if (TargetServer.tagid or 0) == (Server.tagid or 0) then
				<option value="$TargetServer.hostid$" $TargetServer.hostid == Server.TargetServer and "selected" or ""$>$TargetServer.name$</option>
#end
#end
				</select>
			</td>
			<td>
				<button type="button" class="updateZone submit_btn" id="$ZoneName$">修改</button>
			</td>
	</tr>
#end
#end
	<tr>
		<td colspan="7" class="button content" style="text-align:center;">
			<input type="submit" class="submit_btn" name="submit" id="export" value="生成文件"/> 
		</td>
	</tr>
	</tbody>
</table>
</div>
<div>
	<input type=hidden name="serviceid" id="serviceid" value="$ServiceID$">
</div>
</body>
</html>
